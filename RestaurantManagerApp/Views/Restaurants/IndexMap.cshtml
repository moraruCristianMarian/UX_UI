@{
    ViewData["Title"] = "Restaurants Index";
}

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin="" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""></script>

<div class="text-center">
    <h1 class="display-4">Restaurants</h1>
</div>

<div id="map" style="width: 100%; height: 100vh"></div>

@section scripts {
    <script>

        centerLat = 44.435505;
        centerLong = 26.102519;

        var map = L.map('map').setView([centerLat, centerLong], 13);

        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png',
            {
                minZoom: 13,
                maxZoom: 19,
                attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
            }).addTo(map);

        var cornerSW = L.latLng(centerLat - 0.15, centerLong - 0.2);
        var cornerNE = L.latLng(centerLat + 0.15, centerLong + 0.2);
        var bounds = L.latLngBounds(cornerSW, cornerNE);

        map.setMaxBounds(bounds);
        map.on('drag', function () {
            map.panInsideBounds(bounds, { animate: false });
        });

    </script>

    @foreach (RestaurantManagerApp.Models.Restaurant rest in ViewBag.Restaurants)
    {
        <script>
            var rest = @Html.Raw(Json.Serialize(@rest.GeoJSON));
            rest = JSON.parse(rest);

            if (rest != null)
            { 
                var popupHTMLText = "<b>@rest.Name</b>                                            \
                                     <br/>                                                        \
                                     <a class=\"btn btn-success mt-3\" style=\"color:#FFFFFF\"    \
                                        href=\"/Restaurants/Show/@rest.Id\">Informații restaurant</a>";

                var coords = [rest.coordinates[0][0][1], rest.coordinates[0][0][0]]
                var marker = L.marker(coords)
                    .addTo(map)
                    .bindPopup(popupHTMLText);

                L.geoJSON(rest).addTo(map);
            }
        </script>

        <br />
    }
}